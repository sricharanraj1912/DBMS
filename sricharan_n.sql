USE TASKMANAGEMENT
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GETTASKNAMEFOREMPLOYEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_GETTASKNAMEFOREMPLOYEE](@EMPNAME NVARCHAR(50))
RETURNS NVARCHAR(50)
AS
BEGIN 
RETURN ( SELECT TOP 1 T.TASKNAME FROM EMPLOYEE E LEFT OUTER JOIN EMPTASK ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN  TASKTABLE T ON T.TASKID=ET.TASKID
WHERE E.EMPNAME=@EMPNAME AND T.TASKNAME IS NOT NULL)
END

GO
/****** Object:  UserDefinedFunction [dbo].[FN_GETTOTALTASKFOREMPLOYEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_GETTOTALTASKFOREMPLOYEE](@EMPNAME NVARCHAR(50))
RETURNS NVARCHAR(50)
AS
BEGIN 
RETURN ( SELECT COUNT(T.TASKNAME) FROM EMPLOYEE E LEFT OUTER JOIN EMPTASK ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN  TASKTABLE T ON T.TASKID=ET.TASKID
WHERE E.EMPNAME=@EMPNAME AND T.TASKNAME IS NOT NULL)
END
GO
/****** Object:  UserDefinedFunction [dbo].[fnemptocsv]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create function [dbo].[fnemptocsv]()
returns nvarchar(max)
as
begin
declare @empname nvarchar(max), @result nvarchar(max)
declare c1 cursor for 
select empname from employee
open c1
fetch next from c1
into @empname

-- initialy a var will be null so anything concatenated to it will also be null so give its value as empty
set @result=''
while @@FETCH_STATUS=0
begin

--actual logic
set @result=@result+@empname+','
fetch next from c1
into @empname
end
close c1
deallocate c1
return @result

end
GO
/****** Object:  Table [dbo].[EMPLOYEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPLOYEE](
	[EMPID] [int] IDENTITY(1000,1) NOT NULL,
	[EMPNAME] [nvarchar](50) NULL,
	[MANAGERID] [int] NULL,
	[EMAILID] [nvarchar](70) NULL,
	[DOJ] [datetime] NULL,
	[ISACTIVE] [bit] NULL,
 CONSTRAINT [PK_EMPLOYEE] PRIMARY KEY CLUSTERED 
(
	[EMPID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TASKTABLE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TASKTABLE](
	[TASKID] [int] IDENTITY(1,1) NOT NULL,
	[TASKNAME] [nvarchar](150) NULL,
	[STARTDATE] [datetime] NULL,
	[ENDTIME] [datetime] NULL,
 CONSTRAINT [PK_TASKTABLE] PRIMARY KEY CLUSTERED 
(
	[TASKID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPTASK]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPTASK](
	[EMPID] [int] NOT NULL,
	[TASKID] [int] NOT NULL,
	[ISSUBMITTED] [bit] NOT NULL,
	[ISCOMPLETED] [bit] NOT NULL,
	[MODIFIEDON] [datetime] NOT NULL,
 CONSTRAINT [PK_EMPTASK] PRIMARY KEY CLUSTERED 
(
	[EMPID] ASC,
	[TASKID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VW_EMPTASKNAMES]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VW_EMPTASKNAMES] AS
SELECT E.EMPNAME,T.TASKNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASKTABLE AS T ON T.TASKID=ET.TASKID
GO
/****** Object:  View [dbo].[VW_COUNT]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VW_COUNT] AS
SELECT E.EMPNAME, COUNT(T.TASKNAME) AS TASKCOUNT FROM EMPLOYEE E LEFT OUTER JOIN EMPTASK ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN  TASKTABLE T ON T.TASKID=ET.TASKID
GROUP BY E.EMPNAME
GO
/****** Object:  Table [dbo].[EMPBACKUP]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPBACKUP](
	[EMPID] [int] IDENTITY(1000,1) NOT NULL,
	[EMPNAME] [nvarchar](50) NULL,
	[MANAGERID] [int] NULL,
	[EMAILID] [nvarchar](70) NULL,
	[DOJ] [datetime] NULL,
	[ISACTIVE] [bit] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPCLONE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPCLONE](
	[EMPID] [int] IDENTITY(1000,1) NOT NULL,
	[EMPNAME] [nvarchar](50) NULL,
	[MANAGERID] [int] NULL,
	[EMAILID] [nvarchar](70) NULL,
	[DOJ] [datetime] NULL,
	[ISACTIVE] [bit] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EMPCLONEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EMPCLONEE](
	[EMPID] [int] IDENTITY(1000,1) NOT NULL,
	[EMPNAME] [nvarchar](50) NULL,
	[MANAGERID] [int] NULL,
	[EMAILID] [nvarchar](70) NULL,
	[DOJ] [datetime] NULL,
	[ISACTIVE] [bit] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[taskbackup]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[taskbackup](
	[TASKID] [int] IDENTITY(1,1) NOT NULL,
	[TASKNAME] [nvarchar](150) NULL,
	[STARTDATE] [datetime] NULL,
	[ENDTIME] [datetime] NULL
) ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[EMPBACKUP] ON 
GO
INSERT [dbo].[EMPBACKUP] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1000, N'SRICHARAN', 1000, N'SRI@KPMG.COM', CAST(N'2023-09-12T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPBACKUP] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1001, N'NITHYA', 1002, N'SRRR@KPMG.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPBACKUP] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1003, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPBACKUP] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1004, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPBACKUP] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1005, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
SET IDENTITY_INSERT [dbo].[EMPBACKUP] OFF
GO
SET IDENTITY_INSERT [dbo].[EMPCLONE] ON 
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1000, N'SRICHARAN', 1000, N'SRI@KPMG.COM', CAST(N'2023-09-12T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1001, N'NITHYA', 1002, N'SRRR@KPMG.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1002, N'SAMEER', NULL, N'SAMEER@.COM', CAST(N'1995-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1003, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1004, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPCLONE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1005, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
SET IDENTITY_INSERT [dbo].[EMPCLONE] OFF
GO
SET IDENTITY_INSERT [dbo].[EMPLOYEE] ON 
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1000, N'SRICHARAN', 1000, N'SRI@KPMG.COM', CAST(N'2023-09-12T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1001, N'NITHYA', 1002, N'SRRR@KPMG.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1002, N'SAMEER', NULL, N'SAMEER@.COM', CAST(N'1995-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1003, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1004, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 0)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1005, N'BENAMI GUY', 1001, N'BENAMI@.COM', CAST(N'2021-12-04T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1006, N'prajakta', 1000, N'praj@kpmg.com', CAST(N'2022-11-01T00:00:00.000' AS DateTime), 1)
GO
INSERT [dbo].[EMPLOYEE] ([EMPID], [EMPNAME], [MANAGERID], [EMAILID], [DOJ], [ISACTIVE]) VALUES (1007, N'poovi', 1006, N'poov@kpmg.com', CAST(N'2020-11-03T00:00:00.000' AS DateTime), 1)
GO
SET IDENTITY_INSERT [dbo].[EMPLOYEE] OFF
GO
SET IDENTITY_INSERT [dbo].[taskbackup] ON 
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (1, N'day1labwork', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-10-25T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (2, N'day2labwork', CAST(N'2023-10-26T00:00:00.000' AS DateTime), CAST(N'2023-10-27T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (3, N'day3labwork', CAST(N'2023-10-27T00:00:00.000' AS DateTime), CAST(N'2023-10-28T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (4, N'day4labwork', CAST(N'2023-10-28T00:00:00.000' AS DateTime), CAST(N'2023-10-29T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (8, N'day8labwork', CAST(N'1905-06-08T00:00:00.000' AS DateTime), CAST(N'1905-06-07T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (9, N'day9labwork', CAST(N'2023-10-29T00:00:00.000' AS DateTime), CAST(N'2023-10-30T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (10, N'day10labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-09T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (11, N'day11labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (12, N'day12labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (14, N'day14labwork', CAST(N'2023-10-30T00:00:00.000' AS DateTime), CAST(N'2024-10-31T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (15, N'day15labwork', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[taskbackup] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (16, N'day16labwork', CAST(N'2023-10-23T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
SET IDENTITY_INSERT [dbo].[taskbackup] OFF
GO
SET IDENTITY_INSERT [dbo].[TASKTABLE] ON 
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (1, N'DAY1', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-10-25T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (2, N'SQL QUERIES', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2024-10-25T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (3, N'DAY2', CAST(N'2023-10-27T00:00:00.000' AS DateTime), CAST(N'2023-10-28T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (4, N'DAY3', CAST(N'2023-10-28T00:00:00.000' AS DateTime), CAST(N'2023-10-29T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (8, N'DAY4', CAST(N'1905-06-08T00:00:00.000' AS DateTime), CAST(N'1905-06-07T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (9, N'DAY5', CAST(N'2023-10-29T00:00:00.000' AS DateTime), CAST(N'2023-10-30T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (10, N'DAY4', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-09T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (11, N'DAY6', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (12, N'day101', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (14, N'DAY11', CAST(N'2023-10-30T00:00:00.000' AS DateTime), CAST(N'2024-10-31T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (15, N'coding', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (16, N'sqllabwork', CAST(N'2023-10-23T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (17, N'design', CAST(N'2023-10-24T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (18, N'test', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (19, N'day1labwork', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-10-25T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (20, N'day2labwork', CAST(N'2023-10-26T00:00:00.000' AS DateTime), CAST(N'2023-10-27T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (21, N'day3labwork', CAST(N'2023-10-27T00:00:00.000' AS DateTime), CAST(N'2023-10-28T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (22, N'day4labwork', CAST(N'2023-10-28T00:00:00.000' AS DateTime), CAST(N'2023-10-29T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (23, N'day8labwork', CAST(N'1905-06-08T00:00:00.000' AS DateTime), CAST(N'1905-06-07T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (24, N'day9labwork', CAST(N'2023-10-29T00:00:00.000' AS DateTime), CAST(N'2023-10-30T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (25, N'day10labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-09T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (26, N'day11labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (27, N'day12labwork', CAST(N'1894-07-08T00:00:00.000' AS DateTime), CAST(N'1894-07-08T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (28, N'day14labwork', CAST(N'2023-10-30T00:00:00.000' AS DateTime), CAST(N'2024-10-31T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (29, N'day15labwork', CAST(N'2023-10-25T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
INSERT [dbo].[TASKTABLE] ([TASKID], [TASKNAME], [STARTDATE], [ENDTIME]) VALUES (30, N'day16labwork', CAST(N'2023-10-23T00:00:00.000' AS DateTime), CAST(N'2023-12-18T00:00:00.000' AS DateTime))
GO
SET IDENTITY_INSERT [dbo].[TASKTABLE] OFF
GO
ALTER TABLE [dbo].[EMPTASK]  WITH CHECK ADD  CONSTRAINT [FK_EMPTASK_EMPLOYEE] FOREIGN KEY([EMPID])
REFERENCES [dbo].[EMPLOYEE] ([EMPID])
GO
ALTER TABLE [dbo].[EMPTASK] CHECK CONSTRAINT [FK_EMPTASK_EMPLOYEE]
GO
ALTER TABLE [dbo].[EMPTASK]  WITH CHECK ADD  CONSTRAINT [FK_EMPTASK_EMPTASK] FOREIGN KEY([EMPID], [TASKID])
REFERENCES [dbo].[EMPTASK] ([EMPID], [TASKID])
GO
ALTER TABLE [dbo].[EMPTASK] CHECK CONSTRAINT [FK_EMPTASK_EMPTASK]
GO
ALTER TABLE [dbo].[EMPTASK]  WITH CHECK ADD  CONSTRAINT [FK_EMPTASK_TASKTABLE] FOREIGN KEY([TASKID])
REFERENCES [dbo].[TASKTABLE] ([TASKID])
GO
ALTER TABLE [dbo].[EMPTASK] CHECK CONSTRAINT [FK_EMPTASK_TASKTABLE]
GO
/****** Object:  StoredProcedure [dbo].[procedurename]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create procedure [dbo].[procedurename] as
begin
declare @empid int, @empname nvarchar(40), @managerid int, @doj as datetime
declare c1 cursor  for
select empid, empname, doj, managerid from EMPloyee
where isactive =1

open c1
fetch next from c1
into @empid, @empname, @doj,@managerid
print 'in cursor'
while @@FETCH_STATUS=0
begin
 if @doj > '01-01-2022' and @doj < '12-31-2023'
  print @empname+'increment-10%'

  else if @doj between ' 01-01-2021' and '12-31-2023'
  print @empname+'increment-20%'
  
 else  if @doj between '01-01-2020' and '12-31-2023'
  print @empname+'increment-30%'

fetch next from c1 into @empid, @empname, @doj,@managerid
end

close c1
deallocate c1

end

GO
/****** Object:  StoredProcedure [dbo].[SP_alltask]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_alltask] @EMPid int
AS
SELECT E.EMPNAME, T.TASKNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASKTABLE AS T ON T.TASKID=ET.TASKID
WHERE E.EMPid=@EMPid
GO
/****** Object:  StoredProcedure [dbo].[sp_delet]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[sp_delet] @empid int as
delete from emptask where empid=@empid
GO
/****** Object:  StoredProcedure [dbo].[SP_GETEMPTASKNAMES]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--CREATE PROCEDURE
CREATE PROCEDURE [dbo].[SP_GETEMPTASKNAMES] AS
SELECT E.EMPNAME,T.TASKNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASKTABLE AS T ON T.TASKID=ET.TASKID
GO
/****** Object:  StoredProcedure [dbo].[SP_GETTASKNAMEFOREMPLOYEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SP_GETTASKNAMEFOREMPLOYEE] @EMPNAME NVARCHAR(50)
AS
SELECT E.EMPNAME, T.TASKMNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASK AS T ON T.TASKID=ET.TASKID
WHERE E.EMPNAME=@EMPNAME 

EXEC SP_GETTASKNAMEFOREMPLOYEE 'MANOJ' 
GO
/****** Object:  StoredProcedure [dbo].[SP_GETTASKNAMEFOREMPLOYEEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_GETTASKNAMEFOREMPLOYEEE] @EMPNAME NVARCHAR(50)
AS
SELECT E.EMPNAME, T.TASKNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASKTABLE AS T ON T.TASKID=ET.TASKID
WHERE E.EMPNAME=@EMPNAME 
GO
/****** Object:  StoredProcedure [dbo].[SP_GETTASKNAMEFOREMPLOYEEEE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_GETTASKNAMEFOREMPLOYEEEE] @EMPNAME NVARCHAR(50)
AS
SELECT E.EMPNAME, T.TASKNAME FROM EMPLOYEE AS E LEFT OUTER JOIN EMPTASK AS ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN TASKTABLE AS T ON T.TASKID=ET.TASKID
WHERE E.EMPNAME=@EMPNAME AND T.TASKNAME IS NOT NULL
GO
/****** Object:  StoredProcedure [dbo].[sp_time]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_time] @taskid int, @startdate datetime, @endtime datetime
AS
update tasktable
set startdate=@startdate,endtime=@endtime 
where taskid=@taskid
GO
/****** Object:  StoredProcedure [dbo].[STORE_PROCEDURE]    Script Date: 30-10-2023 12:36:42 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[STORE_PROCEDURE] AS
SELECT E.EMPNAME, ET.TASKID, COUNT(T.TASKNAME) AS TASKCOUNT FROM EMPLOYEE E LEFT OUTER JOIN EMPTASK ET ON E.EMPID=ET.EMPID
LEFT OUTER JOIN  TASKTABLE T ON T.TASKID=ET.TASKID
GROUP BY E.EMPNAME, ET.TASKID
GO
